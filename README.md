# Chamael

Chamael includes:

- Go implementation of Kronos
- NoLiveness(NL)
- NoSafety(NS)
- ReConfig(RC)

**Note**: plz place the project directory in the **user's home directory**.

if run failed, you need to run pkill:

``` bash
pkill -f "go_file_name"
```

go_file_name = main or NSnode or NLnode or RCnode


## 1. Go implementation of Kronos

Chamael can be run in 3 ways:
- Local
- All nodes in one Docker
- One node in one Docker

### 1.1 Local

Run on your local machine, one node is one process.

Install dependencies:
``` bash
go mod download
```

Generate node config files based on `cmd/main/config_local.yaml`:
``` bash
go run ./cmd/configMaker/configMaker.go -config_path ./cmd/main/config_local.yaml
```

Start all nodes via shell script:
``` bash
./start_all.sh min_PID max_PID mode start_time
```


### All nodes in one Docker

Build a docker including all nodes in it.

Generate node config files based on `cmd/main/config_local.yaml`:
``` bash
go run ./cmd/configMaker/configMaker.go -config_path ./cmd/main/config_local.yaml
```

Build Docker image via Dockerfile:
``` bash
docker build -t chamael:latest .
```

Start Docker:
``` bash
docker run -it --rm chamael:latest 4 3 1
```

### One node in one Docker

Using Docker compose to run a docker each node.

Generate node config files based on `cmd/main/config_compose.yaml`:
``` bash
go run ./cmd/configMaker/configMaker.go -config_path ./cmd/main/config_compose.yaml
```

Start Docker:
``` bash
docker compose up
```

## 2. NL

config file: `cmd/noLiveness/NL.yaml`:

- NLShardID: ID of no liveness shard
- h: height of block when no liveness happens
- A: accumulator number, as RSA-2048 big.Int

then run:
``` bash
./start_NLTest.sh min_PID max_PID Debug start_time
```

## 3. NS

**Note**: config file `cmd/noSafety/NS.yaml` generated by eviMaker

```
go run cmd/eviMaker/eviMaker.go N F M NSShard
```

- NSShardID: ID of no safety shard
- H: height of block when no safety happens
- A1 & A2: 2 different accumulator number, as RSA-2048 big.Int
- aggsig1 & aggsig2: aggregate signature of A1 & A2
- Nodes1 & Nodes2: nodes who sign aggsig1 & aggsig2

then run:
``` bash
./start_NSTest.sh min_PID max_PID Debug start_time
```

## 4. RC

config file: `cmd/reConfig/RC.yaml`:

- RCShardID: ID of reconfig shard
- H: height of block when reconfig happens
- A: accumulator number, as RSA-2048 big.Int
- NewNodes: new nodes who join the shard

then run:
``` bash
./start_ReConfig.sh min_PID max_PID Debug start_time
```

