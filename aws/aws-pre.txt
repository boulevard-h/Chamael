#!/bin/bash

# the number of AWS servers to remove
N=xxx

# the number of nodes on each server
node=xxx

# public IPs --- This is the public IPs of AWS servers
pubIPsVar=(
[0]='xxx'
[1]='xxx'
[2]='xxx'
)

# 上传配置文件到所有AWS服务器
i=0
while [ $i -le $(( N-1 )) ]; do
    (
    echo "[➤] 开始上传到服务器 ${pubIPsVar[i]}"

    # 并行上传两个路径
    (
        # 上传configs目录内容（保留结构）
        scp -r -q -o "StrictHostKeyChecking no" -i "/home/ubuntu/Chamael.pem" \
            /home/ubuntu/Chamael/configs/* \
            ubuntu@${pubIPsVar[i]}:/home/ubuntu/Chamael/configs/
    ) &
    
    (
        # 上传指定配置文件（精确路径）
        scp -q -o "StrictHostKeyChecking no" -i "/home/ubuntu/Chamael.pem" \
            /home/ubuntu/Chamael/cmd/noSafety/NS.yaml \
            ubuntu@${pubIPsVar[i]}:/home/ubuntu/Chamael/cmd/noSafety/
    ) &
    
    wait 
    echo "[✓] 完成服务器 ${pubIPsVar[i]}"
    ) &
    i=$(( i+1 ))
done

wait
echo "所有文件同步完成"
